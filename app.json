[{"name":"app.R","content":"#### Load necessary libraries\nlibrary(bslib)\nlibrary(shiny)\n\n#### Load coefficients\ncoefs <- read.csv(\"EN_residualdepression_coefficients.csv\")\nscales <- read.csv(\"scaling_parameters_EN_residualdepression.csv\")\n\n#### Define UI\nui <- fluidPage(\n  # Theme of the app\n  theme=bs_theme(primary = \"#3BA688\", secondary = \"#F39498\",\n                 font_scale = NULL, preset = \"minty\"),\n  # App title\n  titlePanel(h1(HTML(\"Developing a clinical prediction model for persistent depressive symptoms after treatment of eating disorders\"),align = \"center\")),\n  \n  # Input on the baseline variables\n  sidebarLayout(\n    sidebarPanel(\n      style = \"width: 450px; padding-right: 20px;\",\n      h4(\"Baseline characteristics\"),\n      \n      fluidRow(\n        column(6,\n               numericInput(\"age\",       \"Age\",                    value = 22, min = 12, max = 66),\n               numericInput(\"bmiadm\",    \"BMI\",      value = 18, min = 9, max = 60),\n               numericInput(\"edeqadm\",   \"EDE-Q global\",         value = 4,  min = 0, max = 6),\n               numericInput(\"bdiadm\",    \"BDI\",      value = 32, min = 10, max = 63),\n               numericInput(\"swlsadm\",   \"Satisfaction with life\", value = 15, min = 5, max = 35),\n               numericInput(\"phqsomadm\", \"PHQ somatic symptoms\",        value = 12,  min = 0, max = 30),\n               numericInput(\"phqanxadm\", \"PHQ anxiety\",        value = 1,  min = 0, max = 1),\n        ),\n        column(6,\n               numericInput(\"bsiintadm\", \"BSI interpersonal sensitivity\", value = 2, min = 0, max = 4),\n               numericInput(\"bsianxadm\", \"BSI anxiety\",        value = 1.5,  min = 0, max = 4),\n               numericInput(\"bsiphoadm\", \"BSI phobic anxiety\", value = 1,  min = 0, max = 4),\n               numericInput(\"bsipsyadm\", \"BSI psychoticism\",   value = 1.5,  min = 0, max = 4),\n               numericInput(\"bsiparadm\", \"BSI paranoid ideation\",       value = 1.3,  min = 0, max = 4),\n               numericInput(\"bsiobsadm\", \"BSI obsessive-compulsion\", value = 1.8, min = 0, max = 4),\n               numericInput(\"brsadm\",    \"Brief Resilience Scale\", value = 2.5, min = 1, max = 5)\n        )\n      )\n    ),\n    mainPanel(\n      verbatimTextOutput(\"predText\"),\n      plotOutput(\"predPlot\", height = \"300px\"),\n      verbatimTextOutput(\"predText_2\")\n    )\n  )\n)\n\n#### Server\nserver <- function(input, output, session) {\n  \n  # reactive linear predictor and probability\n  pred_prob <- reactive({\n    \n    # build a named list of inputs matching the predictor names\n    x_raw <- c(\n      bdiadm    = input$bdiadm,\n      bsianxadm = input$bsianxadm,\n      bsiphoadm = input$bsiphoadm,\n      bsipsyadm = input$bsipsyadm,\n      swlsadm   = input$swlsadm,\n      bsiintadm = input$bsiintadm,\n      edeqadm   = input$edeqadm,\n      bsiparadm = input$bsiparadm,\n      age       = input$age,\n      bsiobsadm = input$bsiobsadm,\n      phqsomadm = input$phqsomadm,\n      bmiadm    = input$bmiadm,\n      phqanxadm = input$phqanxadm,\n      brsadm    = input$brsadm\n    )\n    \n    # Keep only variables that have scaling info\n    vars <- intersect(names(x_raw), scales$variable)\n    \n    df <- merge(\n      data.frame(variable = vars, value = as.numeric(x_raw[vars])),\n      scales,\n      by = \"variable\",\n      all.x = TRUE\n    )\n    \n    # Standardize: (x - mean) / sd\n    df$scaled <- (df$value - df$mean) / df$sd\n    \n    # Get corresponding coefficients in the same order\n    beta <- coefs$estimate[match(df$variable, coefs$predictor)]\n    \n    eta <- coefs$estimate[coefs$predictor==\"(Intercept)\"] + sum(df$scaled * beta, na.rm = TRUE)\n    \n    # logistic transform to get 0â€“1\n    p <- 1 / (1 + exp(-eta))\n    p\n  })\n  \n  output$predText <- renderText({\n    p <- pred_prob()\n    paste0(\"predicted probability of persistent depressive symptoms (BDI discharge > 14): \",\n           round(p * 100, 1), \"%\")\n  })\n  \n  output$predPlot <- renderPlot({\n    p <- pred_prob()\n    \n    # simple number line from 0 to 1 with a dot at p\n    plot(\n      x = c(0, 1),\n      y = c(0, 0),\n      type = \"l\",\n      xlim = c(0, 1),\n      ylim = c(-0.5, 0.5),\n      xlab = \"\",\n      ylab = \"\",\n      yaxt = \"n\",\n      lwd = 3\n    )\n    abline(h = 0, lty = 2)\n    \n    points(p, 0, pch = 19, cex = 2)\n    text(p, 0.2, labels = paste0(round(p * 100, 1), \"%\"), cex = 1.2)\n  })\n  \n  output$predText_2 <- renderText({\n    paste0(\"This is an illustration. Further research is needed before this prediction model can be used in clinical practice.\")\n  })\n}\n\n#### Run the application ####\nshinyApp(ui = ui, server = server)\n","type":"text"},{"name":"EN_residualdepression_coefficients.csv","content":"\"predictor\",\"estimate\"\r\n\"(Intercept)\",0.821785245592106\r\n\"bdiadm\",0.522575970250139\r\n\"bsianxadm\",0.196861374012142\r\n\"bsiphoadm\",0.20462274562\r\n\"bsipsyadm\",0.100202422054738\r\n\"swlsadm\",-0.172030509426296\r\n\"bsiintadm\",0.0331253934971483\r\n\"edeqadm\",0.0287825338165272\r\n\"bsiparadm\",0\r\n\"age\",-0.287107362819688\r\n\"bsiobsadm\",-0.0660350119061481\r\n\"phqsomadm\",-0.0140506787710241\r\n\"bmiadm\",-0.0794331076954081\r\n\"phqanxadm\",0.0168725654131054\r\n\"brsadm\",-0.0851695944410128\r\n","type":"text"},{"name":"EdDepPred.Rproj","content":"Version: 1.0\n\nRestoreWorkspace: Default\nSaveWorkspace: Default\nAlwaysSaveHistory: Default\n\nEnableCodeIndexing: Yes\nUseSpacesForTab: Yes\nNumSpacesForTab: 2\nEncoding: UTF-8\n\nRnwWeave: Sweave\nLaTeX: pdfLaTeX\n","type":"text"},{"name":"scaling_parameters_EN_residualdepression.csv","content":"\"variable\",\"mean\",\"sd\"\r\n\"bdiadm\",32.4080717488789,10.3782730925062\r\n\"bsianxadm\",1.49372197309417,0.83435631311908\r\n\"bsiphoadm\",1.03372197309417,0.897998999277541\r\n\"bsipsyadm\",1.51533632286996,0.861133521321183\r\n\"swlsadm\",14.6295964125561,5.97691724747055\r\n\"bsiintadm\",1.99865470852018,0.919320831808911\r\n\"edeqadm\",4.08149205055035,1.26443703960479\r\n\"bsiparadm\",1.27354260089686,0.825866340578975\r\n\"age\",22.5973094170404,9.87480845112276\r\n\"bsiobsadm\",1.84050822122571,0.855188189245916\r\n\"phqsomadm\",12.580269058296,5.26527579443437\r\n\"bmiadm\",18.480511554792,6.15144132932718\r\n\"phqanxadm\",12.440134529148,4.9673477348269\r\n\"brsadm\",2.50887892376682,0.727958849225152\r\n","type":"text"}]
