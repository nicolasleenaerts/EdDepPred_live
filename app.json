[{"name":"app.R","content":"#### Load necessary libraries\nlibrary(bslib)\nlibrary(shiny)\n\n#### Load coefficients\ncoefs_persistent <- read.csv(\"EN_residualdepression_coefficients.csv\")\ncoefs_non_improvement <- read.csv(\"EN_non-improvement_coefficients.csv\")\nscales <- read.csv(\"scaling_parameters_EN.csv\")\n\n#### Define UI\nui <- fluidPage(\n  # Theme of the app\n  theme=bs_theme(primary = \"#3BA688\", secondary = \"#F39498\",\n                 font_scale = NULL, preset = \"minty\"),\n  # App title\n  titlePanel(h1(HTML(\"Developing a clinical prediction model for persistent depressive symptoms after treatment of eating disorders\"),align = \"center\")),\n  \n  # Input on the baseline variables\n  sidebarLayout(\n    sidebarPanel(\n      style = \"width: 450px; padding-right: 20px;\",\n      h4(\"Baseline characteristics\"),\n      \n      fluidRow(\n        column(6,\n               numericInput(\"age\",       \"Age\",                    value = 22, min = 12, max = 66),\n               numericInput(\"bmiadm\",    \"BMI\",      value = 18.5, min = 9, max = 60),\n               numericInput(\"edeqadm\",   \"EDE-Q global\",         value = 4.1,  min = 0, max = 6),\n               numericInput(\"bdiadm\",    \"BDI\",      value = 32, min = 10, max = 63),\n               numericInput(\"swlsadm\",   \"Satisfaction With Life Scale\", value = 15, min = 5, max = 35),\n               numericInput(\"phqsomadm\", \"PHQ-15\",        value = 13,  min = 0, max = 30),\n               numericInput(\"phqanxadm\", \"GAD-7\",        value = 12.4,  min = 0, max = 21),\n               numericInput(\"brsadm\",    \"Brief Resilience Scale\", value = 2.5, min = 1, max = 5)\n        ),\n        column(6,\n               numericInput(\"bsiintadm\", \"BSI interpersonal sensitivity\", value = 2, min = 0, max = 4),\n               numericInput(\"bsianxadm\", \"BSI anxiety\",        value = 1.5,  min = 0, max = 4),\n               numericInput(\"bsiphoadm\", \"BSI phobic anxiety\", value = 1,  min = 0, max = 4),\n               numericInput(\"bsipsyadm\", \"BSI psychoticism\",   value = 1.5,  min = 0, max = 4),\n               numericInput(\"bsiparadm\", \"BSI paranoid ideation\",       value = 1.3,  min = 0, max = 4),\n               numericInput(\"bsiobsadm\", \"BSI obsessive-compulsion\", value = 1.8, min = 0, max = 4),\n               numericInput(\"bsisomadm\", \"BSI somatization\", value = 1.1, min = 0, max = 4),\n               checkboxInput(\"AN\", \"AN diagnosis (F50.0)\", value = TRUE),\n               checkboxInput(\"BN\", \"BN diagnosis (F50.2)\", value = FALSE)\n               \n        )\n      )\n    ),\n    mainPanel(\n      verbatimTextOutput(\"predText_persistant\"),\n      plotOutput(\"predPlot_persistant\", height = \"300px\"),\n      verbatimTextOutput(\"predText_non_improvement\"),\n      plotOutput(\"predPlot_non_improvement\", height = \"300px\"),\n      verbatimTextOutput(\"predText_2\")\n    )\n  )\n)\n\n#### Server\nserver <- function(input, output, session) {\n  \n  # reactive linear predictor and probability\n  pred_prob_persistant <- reactive({\n    \n    # build a named list of inputs matching the predictor names\n    x_raw <- c(\n      bdiadm    = input$bdiadm,\n      bsianxadm = input$bsianxadm,\n      bsiphoadm = input$bsiphoadm,\n      bsipsyadm = input$bsipsyadm,\n      swlsadm   = input$swlsadm,\n      bsiintadm = input$bsiintadm,\n      edeqadm   = input$edeqadm,\n      bsiparadm = input$bsiparadm,\n      age       = input$age,\n      bsiobsadm = input$bsiobsadm,\n      phqsomadm = input$phqsomadm,\n      bmiadm    = input$bmiadm,\n      phqanxadm = input$phqanxadm,\n      brsadm    = input$brsadm,\n      diagnosis_F50.0 = as.numeric(input$AN),\n      diagnosis_F50.2 = as.numeric(input$BN)\n    )\n    \n    # Keep only variables that have scaling info\n    vars <- intersect(names(x_raw), scales$variable)\n    \n    df <- merge(\n      data.frame(variable = vars, value = as.numeric(x_raw[vars])),\n      scales,\n      by = \"variable\",\n      all.x = TRUE\n    )\n    \n    # Standardize: (x - mean) / sd\n    df$scaled <- (df$value - df$mean) / df$sd\n    \n    # Get corresponding coefficients in the same order\n    beta <- coefs_persistent$estimate[match(df$variable, coefs_persistent$predictor)]\n    \n    eta <- coefs_persistent$estimate[coefs_persistent$predictor==\"(Intercept)\"] + sum(df$scaled * beta, na.rm = TRUE)\n    \n    # logistic transform to get 0–1\n    p <- 1 / (1 + exp(-eta))\n    p\n  })\n  \n  # reactive linear predictor and probability\n  pred_prob_non_improvement <- reactive({\n    \n    # build a named list of inputs matching the predictor names\n    x_raw <- c(\n      bsisomadm    = input$bsisomadm,\n      bsianxadm = input$bsianxadm,\n      bsiphoadm = input$bsiphoadm,\n      bsipsyadm = input$bsipsyadm,\n      swlsadm   = input$swlsadm,\n      bsiintadm = input$bsiintadm,\n      edeqadm   = input$edeqadm,\n      bsiparadm = input$bsiparadm,\n      age       = input$age,\n      bsiobsadm = input$bsiobsadm,\n      phqsomadm = input$phqsomadm,\n      bmiadm    = input$bmiadm,\n      phqanxadm = input$phqanxadm,\n      brsadm    = input$brsadm,\n      diagnosis_F50.0 = as.numeric(input$AN),\n      diagnosis_F50.2 = as.numeric(input$BN)\n    )\n    \n    # Keep only variables that have scaling info\n    vars <- intersect(names(x_raw), scales$variable)\n    \n    df <- merge(\n      data.frame(variable = vars, value = as.numeric(x_raw[vars])),\n      scales,\n      by = \"variable\",\n      all.x = TRUE\n    )\n    \n    # Standardize: (x - mean) / sd\n    df$scaled <- (df$value - df$mean) / df$sd\n    \n    # Get corresponding coefficients in the same order\n    beta <- coefs_non_improvement$estimate[match(df$variable, coefs_non_improvement$predictor)]\n    \n    eta <- coefs_non_improvement$estimate[coefs_non_improvement$predictor==\"(Intercept)\"] + sum(df$scaled * beta, na.rm = TRUE)\n    \n    # logistic transform to get 0–1\n    p <- 1 / (1 + exp(-eta))\n    p\n  })\n  \n  # Outputs for persistant symptoms\n  output$predText_persistant <- renderText({\n    p <- pred_prob_persistant()\n    paste0(\"Predicted probability of persistent depressive symptoms (BDI discharge > 14): \",\n           round(p * 100, 1), \"%\")\n  })\n  \n  output$predPlot_persistant <- renderPlot({\n    p <- pred_prob_persistant()\n    \n    # simple number line from 0 to 1 with a dot at p\n    plot(\n      x = c(0, 1),\n      y = c(0, 0),\n      type = \"l\",\n      xlim = c(0, 1),\n      ylim = c(-0.5, 0.5),\n      xlab = \"\",\n      ylab = \"\",\n      yaxt = \"n\",\n      lwd = 3\n    )\n    abline(h = 0, lty = 2)\n    \n    points(p, 0, pch = 19, cex = 2)\n    text(p, 0.2, labels = paste0(round(p * 100, 1), \"%\"), cex = 1.2)\n  })\n  \n  # Output for non-improvement\n  output$predText_non_improvement <- renderText({\n    p <- pred_prob_non_improvement()\n    paste0(\"Predicted probability of non-improvement of depressive symptoms (BDI reduction < 17.5%): \",\n           round(p * 100, 1), \"%\")\n  })\n  \n  output$predPlot_non_improvement <- renderPlot({\n    p <- pred_prob_non_improvement()\n    \n    # simple number line from 0 to 1 with a dot at p\n    plot(\n      x = c(0, 1),\n      y = c(0, 0),\n      type = \"l\",\n      xlim = c(0, 1),\n      ylim = c(-0.5, 0.5),\n      xlab = \"\",\n      ylab = \"\",\n      yaxt = \"n\",\n      lwd = 3\n    )\n    abline(h = 0, lty = 2)\n    \n    points(p, 0, pch = 19, cex = 2)\n    text(p, 0.2, labels = paste0(round(p * 100, 1), \"%\"), cex = 1.2)\n  })\n  \n  output$predText_2 <- renderText({\n    paste0(\"This is an illustration. Further research is needed before this prediction model can be used in clinical practice.\")\n  })\n}\n\n#### Run the application ####\nshinyApp(ui = ui, server = server)\n\n","type":"text"},{"name":"EN_non-improvement_coefficients.csv","content":"\"predictor\",\"estimate\"\r\n\"(Intercept)\",-0.564895826384967\r\n\"bsiphoadm\",0.275080673488599\r\n\"bsianxadm\",0\r\n\"bsiparadm\",0\r\n\"edeqadm\",0.0375030120756932\r\n\"bsiintadm\",0.016139667860907\r\n\"bsipsyadm\",0\r\n\"bmiadm\",0\r\n\"brsadm\",-0.0830707737119085\r\n\"bsisomadm\",0\r\n\"swlsadm\",-0.0467123950986134\r\n\"age\",-0.0290719876357574\r\n\"phqsomadm\",0\r\n\"diagnosis_F50.0\",0\r\n\"diagnosis_F50.2\",0\r\n","type":"text"},{"name":"EN_residualdepression_coefficients.csv","content":"\"predictor\",\"estimate\"\r\n\"(Intercept)\",0.821785245592106\r\n\"bdiadm\",0.522575970250139\r\n\"bsianxadm\",0.196861374012142\r\n\"bsiphoadm\",0.20462274562\r\n\"bsipsyadm\",0.100202422054738\r\n\"swlsadm\",-0.172030509426296\r\n\"bsiintadm\",0.0331253934971483\r\n\"edeqadm\",0.0287825338165272\r\n\"bsiparadm\",0\r\n\"age\",-0.287107362819688\r\n\"bsiobsadm\",-0.0660350119061481\r\n\"phqsomadm\",-0.0140506787710241\r\n\"bmiadm\",-0.0794331076954081\r\n\"phqanxadm\",0.0168725654131054\r\n\"brsadm\",-0.0851695944410128\r\n","type":"text"},{"name":"EdDepPred.Rproj","content":"Version: 1.0\n\nRestoreWorkspace: Default\nSaveWorkspace: Default\nAlwaysSaveHistory: Default\n\nEnableCodeIndexing: Yes\nUseSpacesForTab: Yes\nNumSpacesForTab: 2\nEncoding: UTF-8\n\nRnwWeave: Sweave\nLaTeX: pdfLaTeX\n","type":"text"},{"name":"scaling_parameters_EN.csv","content":"variable,mean,sd\r\nbdiadm,32.40807175,10.37827309\r\nbsianxadm,1.493721973,0.834356313\r\nbsiphoadm,1.033721973,0.897998999\r\nbsipsyadm,1.515336323,0.861133521\r\nswlsadm,14.62959641,5.976917247\r\nbsiintadm,1.998654709,0.919320832\r\nedeqadm,4.081492051,1.26443704\r\nbsiparadm,1.273542601,0.825866341\r\nage,22.59730942,9.874808451\r\nbsiobsadm,1.840508221,0.855188189\r\nphqsomadm,12.58026906,5.265275794\r\nbmiadm,18.48051155,6.151441329\r\nphqanxadm,12.44013453,4.967347735\r\nbrsadm,2.508878924,0.727958849\r\nbsisomadm,1.10685458,0.782252194\r\ndiagnosis_F50.0,0,1\r\ndiagnosis_F50.2,0,1","type":"text"}]
